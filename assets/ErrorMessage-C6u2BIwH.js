var t,e,s,i,r,a,n,o,h,l,c,u,d,p,f,v,y,m,b,g,R,w,C,O,k,M,x=t=>{throw TypeError(t)},E=(t,e,s)=>e.has(t)||x("Cannot "+s),_=(t,e,s)=>(E(t,e,"read from private field"),s?s.call(t):e.get(t)),S=(t,e,s)=>e.has(t)?x("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,s),W=(t,e,s,i)=>(E(t,e,"write to private field"),i?i.call(t,s):e.set(t,s),s),U=(t,e,s)=>(E(t,e,"access private method"),s);import{n as Q,p as q,o as F,s as I,t as T,v as D,w as j,x as P,y as L,z as A,C as H,D as B,E as z,r as N,F as G,G as V,H as J,j as K,B as X}from"./index-DiawIBuO.js";var Y=(M=class extends Q{constructor(y,m){super(),S(this,v),S(this,t),S(this,e),S(this,s),S(this,i),S(this,r),S(this,a),S(this,n),S(this,o),S(this,h),S(this,l),S(this,c),S(this,u),S(this,d),S(this,p),S(this,f,new Set),this.options=m,W(this,t,y),W(this,o,null),W(this,n,q()),this.options.experimental_prefetchInRender||_(this,n).reject(new Error("experimental_prefetchInRender feature flag is not enabled")),this.bindMethods(),this.setOptions(m)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(_(this,e).addObserver(this),Z(_(this,e),this.options)?U(this,v,y).call(this):this.updateResult(),U(this,v,R).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return $(_(this,e),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return $(_(this,e),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,U(this,v,w).call(this),U(this,v,C).call(this),_(this,e).removeObserver(this)}setOptions(s,i){const r=this.options,a=_(this,e);if(this.options=_(this,t).defaultQueryOptions(s),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled&&"function"!=typeof this.options.enabled&&"boolean"!=typeof F(this.options.enabled,_(this,e)))throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");U(this,v,O).call(this),_(this,e).setOptions(this.options),r._defaulted&&!I(this.options,r)&&_(this,t).getQueryCache().notify({type:"observerOptionsUpdated",query:_(this,e),observer:this});const n=this.hasListeners();n&&tt(_(this,e),a,this.options,r)&&U(this,v,y).call(this),this.updateResult(i),!n||_(this,e)===a&&F(this.options.enabled,_(this,e))===F(r.enabled,_(this,e))&&T(this.options.staleTime,_(this,e))===T(r.staleTime,_(this,e))||U(this,v,m).call(this);const o=U(this,v,b).call(this);!n||_(this,e)===a&&F(this.options.enabled,_(this,e))===F(r.enabled,_(this,e))&&o===_(this,p)||U(this,v,g).call(this,o)}getOptimisticResult(s){const n=_(this,t).getQueryCache().build(_(this,t),s),o=this.createResult(n,s);return function(t,e){if(!I(t.getCurrentResult(),e))return!0;return!1}(this,o)&&(W(this,i,o),W(this,a,this.options),W(this,r,_(this,e).state)),o}getCurrentResult(){return _(this,i)}trackResult(t,e){const s={};return Object.keys(t).forEach((i=>{Object.defineProperty(s,i,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(i),null==e||e(i),t[i])})})),s}trackProp(t){_(this,f).add(t)}getCurrentQuery(){return _(this,e)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(e){const s=_(this,t).defaultQueryOptions(e),i=_(this,t).getQueryCache().build(_(this,t),s);return i.fetch().then((()=>this.createResult(i,s)))}fetch(t){return U(this,v,y).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then((()=>(this.updateResult(),_(this,i))))}createResult(t,u){var d;const p=_(this,e),f=this.options,v=_(this,i),y=_(this,r),m=_(this,a),b=t!==p?t.state:_(this,s),{state:g}=t;let R,w={...g},C=!1;if(u._optimisticResults){const e=this.hasListeners(),s=!e&&Z(t,u),i=e&&tt(t,p,u,f);(s||i)&&(w={...w,...H(g.data,t.options)}),"isRestoring"===u._optimisticResults&&(w.fetchStatus="idle")}let{error:O,errorUpdatedAt:k,status:M}=w;if(u.select&&void 0!==w.data)if(v&&w.data===(null==y?void 0:y.data)&&u.select===_(this,h))R=_(this,l);else try{W(this,h,u.select),R=u.select(w.data),R=B(null==v?void 0:v.data,R,u),W(this,l,R),W(this,o,null)}catch(I){W(this,o,I)}else R=w.data;if(void 0!==u.placeholderData&&void 0===R&&"pending"===M){let t;if((null==v?void 0:v.isPlaceholderData)&&u.placeholderData===(null==m?void 0:m.placeholderData))t=v.data;else if(t="function"==typeof u.placeholderData?u.placeholderData(null==(d=_(this,c))?void 0:d.state.data,_(this,c)):u.placeholderData,u.select&&void 0!==t)try{t=u.select(t),W(this,o,null)}catch(I){W(this,o,I)}void 0!==t&&(M="success",R=B(null==v?void 0:v.data,t,u),C=!0)}_(this,o)&&(O=_(this,o),R=_(this,l),k=Date.now(),M="error");const x="fetching"===w.fetchStatus,E="pending"===M,S="error"===M,U=E&&x,Q=void 0!==R,F={status:M,fetchStatus:w.fetchStatus,isPending:E,isSuccess:"success"===M,isError:S,isInitialLoading:U,isLoading:U,data:R,dataUpdatedAt:w.dataUpdatedAt,error:O,errorUpdatedAt:k,failureCount:w.fetchFailureCount,failureReason:w.fetchFailureReason,errorUpdateCount:w.errorUpdateCount,isFetched:w.dataUpdateCount>0||w.errorUpdateCount>0,isFetchedAfterMount:w.dataUpdateCount>b.dataUpdateCount||w.errorUpdateCount>b.errorUpdateCount,isFetching:x,isRefetching:x&&!E,isLoadingError:S&&!Q,isPaused:"paused"===w.fetchStatus,isPlaceholderData:C,isRefetchError:S&&Q,isStale:et(t,u),refetch:this.refetch,promise:_(this,n)};if(this.options.experimental_prefetchInRender){const e=t=>{"error"===F.status?t.reject(F.error):void 0!==F.data&&t.resolve(F.data)},s=()=>{const t=W(this,n,F.promise=q());e(t)},i=_(this,n);switch(i.status){case"pending":t.queryHash===p.queryHash&&e(i);break;case"fulfilled":"error"!==F.status&&F.data===i.value||s();break;case"rejected":"error"===F.status&&F.error===i.reason||s()}}return F}updateResult(t){const s=_(this,i),n=this.createResult(_(this,e),this.options);if(W(this,r,_(this,e).state),W(this,a,this.options),void 0!==_(this,r).data&&W(this,c,_(this,e)),I(n,s))return;W(this,i,n);const o={};!1!==(null==t?void 0:t.listeners)&&(()=>{if(!s)return!0;const{notifyOnChangeProps:t}=this.options,e="function"==typeof t?t():t;if("all"===e||!e&&!_(this,f).size)return!0;const r=new Set(e??_(this,f));return this.options.throwOnError&&r.add("error"),Object.keys(_(this,i)).some((t=>{const e=t;return _(this,i)[e]!==s[e]&&r.has(e)}))})()&&(o.listeners=!0),U(this,v,k).call(this,{...o,...t})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&U(this,v,R).call(this)}},t=new WeakMap,e=new WeakMap,s=new WeakMap,i=new WeakMap,r=new WeakMap,a=new WeakMap,n=new WeakMap,o=new WeakMap,h=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,p=new WeakMap,f=new WeakMap,v=new WeakSet,y=function(t){U(this,v,O).call(this);let s=_(this,e).fetch(this.options,t);return(null==t?void 0:t.throwOnError)||(s=s.catch(D)),s},m=function(){U(this,v,w).call(this);const t=T(this.options.staleTime,_(this,e));if(j||_(this,i).isStale||!P(t))return;const s=L(_(this,i).dataUpdatedAt,t);W(this,u,setTimeout((()=>{_(this,i).isStale||this.updateResult()}),s+1))},b=function(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(_(this,e)):this.options.refetchInterval)??!1},g=function(t){U(this,v,C).call(this),W(this,p,t),!j&&!1!==F(this.options.enabled,_(this,e))&&P(_(this,p))&&0!==_(this,p)&&W(this,d,setInterval((()=>{(this.options.refetchIntervalInBackground||A.isFocused())&&U(this,v,y).call(this)}),_(this,p)))},R=function(){U(this,v,m).call(this),U(this,v,g).call(this,U(this,v,b).call(this))},w=function(){_(this,u)&&(clearTimeout(_(this,u)),W(this,u,void 0))},C=function(){_(this,d)&&(clearInterval(_(this,d)),W(this,d,void 0))},O=function(){const i=_(this,t).getQueryCache().build(_(this,t),this.options);if(i===_(this,e))return;const r=_(this,e);W(this,e,i),W(this,s,i.state),this.hasListeners()&&(null==r||r.removeObserver(this),i.addObserver(this))},k=function(s){z.batch((()=>{s.listeners&&this.listeners.forEach((t=>{t(_(this,i))})),_(this,t).getQueryCache().notify({query:_(this,e),type:"observerResultsUpdated"})}))},M);function Z(t,e){return function(t,e){return!1!==F(e.enabled,t)&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&$(t,e,e.refetchOnMount)}function $(t,e,s){if(!1!==F(e.enabled,t)){const i="function"==typeof s?s(t):s;return"always"===i||!1!==i&&et(t,e)}return!1}function tt(t,e,s,i){return(t!==e||!1===F(i.enabled,t))&&(!s.suspense||"error"!==t.state.status)&&et(t,s)}function et(t,e){return!1!==F(e.enabled,t)&&t.isStaleByTime(T(e.staleTime,t))}var st=N.createContext(!1);st.Provider;var it=N.createContext(function(){let t=!1;return{clearReset:()=>{t=!1},reset:()=>{t=!0},isReset:()=>t}}()),rt=(t,e,s)=>e.fetchOptimistic(t).catch((()=>{s.clearReset()}));function at(t,e,s){var i,r,a,n,o;const h=V(s),l=N.useContext(st),c=N.useContext(it),u=h.defaultQueryOptions(t);null==(r=null==(i=h.getDefaultOptions().queries)?void 0:i._experimental_beforeQuery)||r.call(i,u),u._optimisticResults=l?"isRestoring":"optimistic",(t=>{const e=t.staleTime;t.suspense&&(t.staleTime="function"==typeof e?(...t)=>Math.max(e(...t),1e3):Math.max(e??1e3,1e3),"number"==typeof t.gcTime&&(t.gcTime=Math.max(t.gcTime,1e3)))})(u),((t,e)=>{(t.suspense||t.throwOnError||t.experimental_prefetchInRender)&&(e.isReset()||(t.retryOnMount=!1))})(u,c),(t=>{N.useEffect((()=>{t.clearReset()}),[t])})(c);const d=!h.getQueryCache().get(u.queryHash),[p]=N.useState((()=>new e(h,u))),f=p.getOptimisticResult(u),v=!l&&!1!==t.subscribed;if(N.useSyncExternalStore(N.useCallback((t=>{const e=v?p.subscribe(z.batchCalls(t)):J;return p.updateResult(),e}),[p,v]),(()=>p.getCurrentResult()),(()=>p.getCurrentResult())),N.useEffect((()=>{p.setOptions(u,{listeners:!1})}),[u,p]),((t,e)=>(null==t?void 0:t.suspense)&&e.isPending)(u,f))throw rt(u,p,c);if((({result:t,errorResetBoundary:e,throwOnError:s,query:i,suspense:r})=>t.isError&&!e.isReset()&&!t.isFetching&&i&&(r&&void 0===t.data||G(s,[t.error,i])))({result:f,errorResetBoundary:c,throwOnError:u.throwOnError,query:h.getQueryCache().get(u.queryHash),suspense:u.suspense}))throw f.error;if(null==(n=null==(a=h.getDefaultOptions().queries)?void 0:a._experimental_afterQuery)||n.call(a,u,f),u.experimental_prefetchInRender&&!j&&((t,e)=>t.isLoading&&t.isFetching&&!e)(f,l)){const t=d?rt(u,p,c):null==(o=h.getQueryCache().get(u.queryHash))?void 0:o.promise;null==t||t.catch(J).finally((()=>{p.updateResult()}))}return u.notifyOnChangeProps?f:p.trackResult(f)}function nt(t,e){return at(t,Y,e)}const ot=t=>{N.useEffect((()=>{if(!t)return;const e=document.createElement("link");return e.rel="preload",e.as="image",e.href=t,document.head.appendChild(e),()=>{document.head.removeChild(e)}}),[t])},ht="ErrorMessage-module__error__wrapper__40RVg",lt="ErrorMessage-module__error__text__O4qqv",ct=({onRetry:t})=>K.jsxs("div",{className:ht,children:[K.jsx("span",{className:lt,children:"Произошла непредвиденная ошибка :("}),K.jsx(X,{text:"Повторить запрос",onClick:t})]});export{ct as E,ot as a,nt as u};
